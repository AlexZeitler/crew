machine:
  timezone: Europe/Berlin

  pre:
    - curl https://raw.githubusercontent.com/creationix/nvm/v0.23.3/install.sh | bash

  node:
    version: 0.12.0

  services:
    - docker

  environment:
    DOCKER_HOST: tcp://localhost:2376
    DOCKER_TLS_VERIFY: yes
    DOCKER_CERT_PATH: $HOME/$CIRCLE_PROJECT_REPONAME/test/certificate

dependencies:
  pre:
    - npm install -g grunt-cli

test:
  pre:
    - sudo sed -i "s/^DOCKER_OPTS.*$/DOCKER_OPTS=\"-s\ btrfs\ -e\ lxc\ -H=tcp:\/\/127\.0\.0\.1:2376\ --tlsverify\ --tlscacert=\$DOCKER_CERT_PATH\/ca\.pem\ --tlscert=\$DOCKER_CERT_PATH\/cert\.pem\ --tlskey=\$DOCKER_CERT_PATH\/key\.pem\"/" /etc/default/docker
    - sudo service docker restart
    - docker build -t thenativeweb/crew-test .

  override:
    - grunt
